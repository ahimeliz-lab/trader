{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo/trader/app/api/equity/route.ts"],"sourcesContent":["import \"server-only\";\r\nimport { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\nexport const runtime = \"nodejs\";\r\nexport const dynamic = \"force-dynamic\";\r\nexport const revalidate = 0;\r\n\r\nfunction env(name: string): string {\r\n  const v = process.env[name];\r\n  if (!v) throw new Error(`Missing env var: ${name}`);\r\n  return v;\r\n}\r\n\r\nfunction sbAdmin() {\r\n  return createClient(env(\"SUPABASE_URL\"), env(\"SUPABASE_SERVICE_ROLE_KEY\"), {\r\n    auth: { persistSession: false },\r\n  });\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const accountId = searchParams.get(\"accountId\");\r\n    const limit = Math.min(Number(searchParams.get(\"limit\") ?? 500), 5000);\r\n\r\n    if (!accountId) {\r\n      return NextResponse.json({ ok: false, error: \"accountId required\" }, { status: 400 });\r\n    }\r\n\r\n    const sb = sbAdmin();\r\n\r\n    const { data, error } = await sb\r\n      .from(\"trade_equity_points\")\r\n      .select(\"created_at,equity_usd,cash_usd,note\")\r\n      .eq(\"account_id\", accountId)\r\n      .order(\"created_at\", { ascending: true })\r\n      .limit(limit);\r\n\r\n    if (error) throw new Error(error.message);\r\n\r\n    return NextResponse.json({ ok: true, points: data ?? [] }, { status: 200 });\r\n  } catch (e) {\r\n    return NextResponse.json({ ok: false, error: (e as Error).message }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;;;;AAEO,MAAM,UAAU;AAChB,MAAM,UAAU;AAChB,MAAM,aAAa;AAE1B,SAAS,IAAI,IAAY;IACvB,MAAM,IAAI,QAAQ,GAAG,CAAC,KAAK;IAC3B,IAAI,CAAC,GAAG,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,MAAM;IAClD,OAAO;AACT;AAEA,SAAS;IACP,OAAO,IAAA,gMAAY,EAAC,IAAI,iBAAiB,IAAI,8BAA8B;QACzE,MAAM;YAAE,gBAAgB;QAAM;IAChC;AACF;AAEO,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,YAAY,aAAa,GAAG,CAAC;QACnC,MAAM,QAAQ,KAAK,GAAG,CAAC,OAAO,aAAa,GAAG,CAAC,YAAY,MAAM;QAEjE,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QACrF;QAEA,MAAM,KAAK;QAEX,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,GAC3B,IAAI,CAAC,uBACL,MAAM,CAAC,uCACP,EAAE,CAAC,cAAc,WACjB,KAAK,CAAC,cAAc;YAAE,WAAW;QAAK,GACtC,KAAK,CAAC;QAET,IAAI,OAAO,MAAM,IAAI,MAAM,MAAM,OAAO;QAExC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,QAAQ,QAAQ,EAAE;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC3E,EAAE,OAAO,GAAG;QACV,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO,AAAC,EAAY,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrF;AACF"}}]
}
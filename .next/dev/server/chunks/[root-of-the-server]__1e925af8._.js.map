{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo/trader/app/api/last-execution/route.ts"],"sourcesContent":["import \"server-only\";\nimport { NextResponse } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nexport const runtime = \"nodejs\";\nexport const dynamic = \"force-dynamic\";\nexport const revalidate = 0;\n\nfunction env(name: string): string {\n  const v = process.env[name];\n  if (!v) throw new Error(`Missing env var: ${name}`);\n  return v;\n}\n\nfunction sbAdmin() {\n  return createClient(env(\"SUPABASE_URL\"), env(\"SUPABASE_SERVICE_ROLE_KEY\"), {\n    auth: { persistSession: false },\n  });\n}\n\nexport async function GET(req: Request) {\n  try {\n    const url = new URL(req.url);\n    const accountId = (url.searchParams.get(\"accountId\") ?? \"\").trim();\n    if (!accountId) return NextResponse.json({ ok: false, error: \"accountId required\" }, { status: 400 });\n\n    const sb = sbAdmin();\n    let order: any = null;\n    let fill: any = null;\n\n    try {\n      const { data, error } = await sb\n        .from(\"trade_orders\")\n        .select(\"*\")\n        .eq(\"account_id\", accountId)\n        .order(\"created_at\", { ascending: false })\n        .limit(1)\n        .maybeSingle();\n      if (!error && data) order = data;\n    } catch {\n      // fallback if created_at doesn't exist\n      const { data } = await sb\n        .from(\"trade_orders\")\n        .select(\"*\")\n        .eq(\"account_id\", accountId)\n        .order(\"id\", { ascending: false })\n        .limit(1)\n        .maybeSingle();\n      order = data ?? null;\n    }\n\n    if (order?.id) {\n      const { data } = await sb\n        .from(\"trade_fills\")\n        .select(\"*\")\n        .eq(\"order_id\", order.id)\n        .order(\"created_at\", { ascending: false })\n        .limit(1)\n        .maybeSingle();\n      fill = data ?? null;\n    }\n\n    return NextResponse.json({ ok: true, order, fill }, { status: 200 });\n  } catch (e) {\n    return NextResponse.json({ ok: false, error: (e as Error).message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;;;;AAEO,MAAM,UAAU;AAChB,MAAM,UAAU;AAChB,MAAM,aAAa;AAE1B,SAAS,IAAI,IAAY;IACvB,MAAM,IAAI,QAAQ,GAAG,CAAC,KAAK;IAC3B,IAAI,CAAC,GAAG,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,MAAM;IAClD,OAAO;AACT;AAEA,SAAS;IACP,OAAO,IAAA,gMAAY,EAAC,IAAI,iBAAiB,IAAI,8BAA8B;QACzE,MAAM;YAAE,gBAAgB;QAAM;IAChC;AACF;AAEO,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;QAC3B,MAAM,YAAY,CAAC,IAAI,YAAY,CAAC,GAAG,CAAC,gBAAgB,EAAE,EAAE,IAAI;QAChE,IAAI,CAAC,WAAW,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAqB,GAAG;YAAE,QAAQ;QAAI;QAEnG,MAAM,KAAK;QACX,IAAI,QAAa;QACjB,IAAI,OAAY;QAEhB,IAAI;YACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,GAC3B,IAAI,CAAC,gBACL,MAAM,CAAC,KACP,EAAE,CAAC,cAAc,WACjB,KAAK,CAAC,cAAc;gBAAE,WAAW;YAAM,GACvC,KAAK,CAAC,GACN,WAAW;YACd,IAAI,CAAC,SAAS,MAAM,QAAQ;QAC9B,EAAE,OAAM;YACN,uCAAuC;YACvC,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,GACpB,IAAI,CAAC,gBACL,MAAM,CAAC,KACP,EAAE,CAAC,cAAc,WACjB,KAAK,CAAC,MAAM;gBAAE,WAAW;YAAM,GAC/B,KAAK,CAAC,GACN,WAAW;YACd,QAAQ,QAAQ;QAClB;QAEA,IAAI,OAAO,IAAI;YACb,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,GACpB,IAAI,CAAC,eACL,MAAM,CAAC,KACP,EAAE,CAAC,YAAY,MAAM,EAAE,EACvB,KAAK,CAAC,cAAc;gBAAE,WAAW;YAAM,GACvC,KAAK,CAAC,GACN,WAAW;YACd,OAAO,QAAQ;QACjB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM;YAAO;QAAK,GAAG;YAAE,QAAQ;QAAI;IACpE,EAAE,OAAO,GAAG;QACV,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO,AAAC,EAAY,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrF;AACF"}}]
}
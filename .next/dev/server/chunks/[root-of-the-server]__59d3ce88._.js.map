{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo/trader/app/api/positions/route.ts"],"sourcesContent":["import \"server-only\";\nimport { NextResponse } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nexport const runtime = \"nodejs\";\nexport const dynamic = \"force-dynamic\";\nexport const revalidate = 0;\n\nfunction env(name: string): string {\n  const v = process.env[name];\n  if (!v) throw new Error(`Missing env var: ${name}`);\n  return v;\n}\n\nfunction sbAdmin() {\n  return createClient(env(\"SUPABASE_URL\"), env(\"SUPABASE_SERVICE_ROLE_KEY\"), {\n    auth: { persistSession: false },\n  });\n}\n\nexport async function GET(req: Request) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const accountId = searchParams.get(\"accountId\");\n    if (!accountId) {\n      return NextResponse.json({ ok: false, error: \"accountId required\" }, { status: 400 });\n    }\n\n    const sb = sbAdmin();\n\n    const { data: acct, error: acctErr } = await sb\n      .from(\"trade_accounts\")\n      .select(\"id,cash_balance\")\n      .eq(\"id\", accountId)\n      .maybeSingle();\n\n    if (acctErr) throw new Error(acctErr.message);\n\n    const { data: positions, error: posErr } = await sb\n      .from(\"trade_positions\")\n      .select(\"symbol,qty,avg_entry_price,realized_pnl_usd,updated_at\")\n      .eq(\"account_id\", accountId);\n\n    if (posErr) throw new Error(posErr.message);\n\n    return NextResponse.json(\n      {\n        ok: true,\n        account: acct ?? null,\n        positions: positions ?? [],\n      },\n      { status: 200 }\n    );\n  } catch (e) {\n    return NextResponse.json({ ok: false, error: (e as Error).message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;;;;AAEO,MAAM,UAAU;AAChB,MAAM,UAAU;AAChB,MAAM,aAAa;AAE1B,SAAS,IAAI,IAAY;IACvB,MAAM,IAAI,QAAQ,GAAG,CAAC,KAAK;IAC3B,IAAI,CAAC,GAAG,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,MAAM;IAClD,OAAO;AACT;AAEA,SAAS;IACP,OAAO,IAAA,gMAAY,EAAC,IAAI,iBAAiB,IAAI,8BAA8B;QACzE,MAAM;YAAE,gBAAgB;QAAM;IAChC;AACF;AAEO,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,YAAY,aAAa,GAAG,CAAC;QACnC,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QACrF;QAEA,MAAM,KAAK;QAEX,MAAM,EAAE,MAAM,IAAI,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,GAC1C,IAAI,CAAC,kBACL,MAAM,CAAC,mBACP,EAAE,CAAC,MAAM,WACT,WAAW;QAEd,IAAI,SAAS,MAAM,IAAI,MAAM,QAAQ,OAAO;QAE5C,MAAM,EAAE,MAAM,SAAS,EAAE,OAAO,MAAM,EAAE,GAAG,MAAM,GAC9C,IAAI,CAAC,mBACL,MAAM,CAAC,0DACP,EAAE,CAAC,cAAc;QAEpB,IAAI,QAAQ,MAAM,IAAI,MAAM,OAAO,OAAO;QAE1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,IAAI;YACJ,SAAS,QAAQ;YACjB,WAAW,aAAa,EAAE;QAC5B,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,GAAG;QACV,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO,AAAC,EAAY,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrF;AACF"}}]
}